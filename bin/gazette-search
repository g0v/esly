#!/usr/bin/env perl
use v5.16;

use utf8;
use Term::ANSIColor;

use ElasticSearch;

binmode STDIN, ":utf8";
binmode STDOUT, ":utf8";

my $q = shift(@ARGV) || "q = ?";

utf8::decode($q);

my $es = ElasticSearch->new;

my $res = $es->search(
    index => "lyg0v",
    type  => "interp_body",
    query => {
        text => {
            content => $q
        }
    },
    highlight => {
        fields => { content => {} },
    }
);

if ($res->{hits}{total}) {
    for my $hit (@{ $res->{hits}{hits} }) {
        say $hit->{_source}{speaker};
        for my $line (@{ $hit->{highlight}{content} }) {
            $line =~ s!<em>!color 'bold red'!eg;
            $line =~ s!</em>!color 'reset'!eg;
            say "  - $line";
        }
        say "";
    }
}
else {
    say "No Results";
}
